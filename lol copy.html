<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 150vh;
            overflow-x: hidden ;
        }
        .main{
            width: 60%;
            height: auto;
            padding-bottom: 10px;
            background-color: rgb(104, 104, 104);
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;   
            border-radius: 5px;
        }
        .innermain{
            display: grid;
            width: 90%;
            height: 90%;
            background-color: rgb(71, 71, 71);
            grid-template-columns: repeat(6, 1fr); /* 4 kolom dengan ukuran yang sama */
            grid-template-rows: repeat(10, 50px); /* 5 baris dengan tinggi 100px */
            gap: 5px;

        }

        .isi-kotak{
            width: 100%;
            height: 100%;
            background-color: rgb(143, 143, 143);
            border-radius: 8px;
        }
        #gameover{
            position:absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
        }
    </style>
</head>
<body>
        <h1 id="gameover"></h1>
        <h1>AlgaEater</h1><br>
        <p>Score : <span id="score"></span></p>
        <p>Eaten Alga : <span id="index"></span></p>
        <p><span id="timer"></span></p>
    
    <div class="main">
        <div class="innermain" id="main">
            <div class="isi-kotak" id="1"></div>
            <div class="isi-kotak" id="2"></div>
            <div class="isi-kotak" id="3"></div>
            <div class="isi-kotak" id="4"></div>
            <div class="isi-kotak" id="5"></div>
            <div class="isi-kotak" id="6"></div>
            <div class="isi-kotak" id="7"></div>
            <div class="isi-kotak" id="8"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>            
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="1"></div>
            <div class="isi-kotak" id="2"></div>
            <div class="isi-kotak" id="3"></div>
            <div class="isi-kotak" id="4"></div>
            <div class="isi-kotak" id="5"></div>
            <div class="isi-kotak" id="6"></div>
            <div class="isi-kotak" id="7"></div>
            <div class="isi-kotak" id="8"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>            
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            <div class="isi-kotak" id="9"></div>
            <div class="isi-kotak" id="10"></div>
            <div class="isi-kotak" id="11"></div>
            <div class="isi-kotak" id="12"></div>
            
        </div>
    </div>
    <script>
        function main(){
            const parent = document.getElementById('main')
            const children = parent.children
            let score = 0
            console.log(children)


            function acakAngka(){
                const randomNumber = Math.floor(Math.random() * 50 + 6)
                return randomNumber
            }
            
            function acakAngka1(){
                const randomNumber = Math.floor(Math.random() * 6)
                return randomNumber
            }


            function rintangan(acak){
                children[acak].style.backgroundColor = 'green'

                return acak
            }
            function rintangan1(acak){
                children[acak].style.backgroundColor = 'red'
                return acak
            }









            function player(acak){
                // Ubah warna background dari elemen
                children[acak].style.backgroundColor = 'blue';
                return acak 
            }

            function normal(index){
                children[index].style.backgroundColor = 'grey'
            }

            let playerAngka = player(acakAngka1())

            function generateUniqueNumbers(n, min, max) {
                const uniqueNumbers = new Set();

                while (uniqueNumbers.size < n) {
                    const number = Math.floor(Math.random() * (max - min + 1)) + min;
                    uniqueNumbers.add(number);
                }

                return Array.from(uniqueNumbers);
            }


            let list_alga = generateUniqueNumbers(15, 6, 59)
            let list_bom = []
            
            for (let i=0;i < list_alga.length; i++){
                rintangan(list_alga[i])
            }   
            
            for (let i=0;i < 19; i++){
                let a = acakAngka()
                if(a == 28|| a== 25||a==22){
                    break

                }
                let index = rintangan1(a)
                
                list_bom.push(index)
            }   

            list_alga = list_alga.filter(item => !list_bom.includes(item));
            list_bom = list_bom.filter(item => !list_alga.includes(item));



            console.log(list_alga)
            console.log(list_bom)



            document.addEventListener('keydown', function(event) {
                switch(event.key) {
                    case 'A':
                    case 'a':
                    case 'ArrowLeft':
                        event.preventDefault()
                        if (playerAngka % 6 == 0) {
                            break
                        }
                        normal(playerAngka)
                        playerAngka = Number(playerAngka) - 1
                        player(playerAngka)
                        break
                    case 'd':
                    case 'D':
                    case 'ArrowRight':
                        event.preventDefault()
                        if (playerAngka > 59 || (playerAngka + 1) % 6 == 0) {
                            break
                        }
                        normal(playerAngka)
                        playerAngka += 1
                        player(playerAngka)
                        break
                    case 'W':
                    case 'w':
                    case 'ArrowUp':
                        event.preventDefault()
                        if (playerAngka < 6) {
                            break
                        }
                        normal(playerAngka)
                        playerAngka -= 6
                        player(playerAngka)
                        break
                    case 's':
                    case 'S':
                    case 'ArrowDown':
                            event.preventDefault()
                        if (playerAngka > 53) {
                            break
                        }
                        normal(playerAngka)
                        playerAngka += 6
                        player(playerAngka)
                        break
                    default:
                        break
                }
                function sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                    }

                // This part should be inside the event listener but outside the switch
                for (let i = 0; i < list_alga.length; i++) {
                    console.log('lol')
                    if (list_alga[i] === playerAngka) {
                        score += 1
                        list_alga.splice(i, 1)
                        document.getElementById('score').innerHTML = score
                        document.getElementById('index').innerHTML = score+"/"+(list_alga.length +score)
                        localStorage.setItem("score", score)


                        if(score == list_alga.length+score){
                            document.getElementById('gameover').innerHTML = 'You Win'
                            document.getElementById('gameover').style.backgroundColor = 'green'
                            document.getElementById('gameover').style.backdropFilter = 'blur(8px)'
         
                            for (let i=0;i < list_alga.length; i++){
                                rintangan(list_alga[i])
                            }   
                            
                            for (let i=0;i < 8; i++){
                                let index = rintangan1(a)
                            }  
                        }

                    }
                }
                for  (let i = 0; i < list_alga.length; i++) {
                    if(list_bom[i] === playerAngka){
                        score = 0
                        document.getElementById('score').innerHTML = score
                        document.getElementById('gameover').innerHTML = 'You Lose'
                        document.getElementById('gameover').style.backgroundColor = 'rgb(255, 71, 71)'
                        document.getElementById('gameover').style.backdropFilter = 'blur(8px)'
     
                        for (let i=0;i < list_alga.length; i++){
                            rintangan(list_alga[i])
                        }   
                        
                        for (let i=0;i < 8; i++){
                            let index = rintangan1(a)
                            list_bom.push(index)
                        }  
                    }
                }


            });
            setTimeout(() => {
                    for (let i = 1; i < children.length; i++) {
                        normal(i)
                        player(playerAngka)
                    };
                }, 1000); // 2000 ms = 2 detik

            document.addEventListener('keydown', function(event) {
                // Check if the pressed key is 'Enter'
                if (event.key === 'R'||event.key === 'r') {
                    // Reload the current page
                    location.reload();
                }
            });


            function startTimer(seconds) {
                let timeRemaining = seconds;

                const timerInterval = setInterval(() => {
                    document.getElementById('timer').innerHTML = `Time remaining: ${timeRemaining} seconds`
                    
                    if (timeRemaining <= 0) {
                        clearInterval(timerInterval); // Stop the timer
                        if(score < list_alga.length+score){
                            document.getElementById('gameover').innerHTML = 'You Lose'
                            document.getElementById('gameover').style.backgroundColor = 'red'
                            document.getElementById('gameover').style.backdropFilter = 'blur(8px)'
                            for (let i=0;i < list_alga.length; i++){
                                rintangan(list_alga[i])
                            }   
                            
                            for (let i=0;i < 8; i++){
                                let index = rintangan1(a)
                                list_bom.push(index)
                            }  
                        }
                    } else {
                        timeRemaining--; // Decrease time remaining
                    }
                }, 1000); // 1000 ms = 1 second
            }
            startTimer(15)
            
        }
        main()
        document.addEventListener('keydown', function(event) {
            // Check if the pressed key is 'Enter'
            if (event.key === 'R'||event.key === 'r') {
                // Reload the current page
                location.reload();
                main()
                score = localStorage.getItem('score')
            }
        });

        


        


    </script>
    
</body>
</html>